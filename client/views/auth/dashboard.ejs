<!DOCTYPE html>
<html lang="en">
    <head>
        <%- include('../partials/head'); %>
    </head>
    <body id="page-top">
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg bg-secondary fixed-top" id="mainNav">
            <%- include('../partials/topmenu'); %>
        </nav>


        <!-- Page Content -->
        <section class="page-section page-section-top-padded mb-0" id="about">
            <div class="container navbar-interior font-weight-bold text-primary">
                <%- include('../partials/welcome'); %>
            </div>
            <div class="container">
                
                <!-- About Section Heading-->
                <div class="divider-custom">
                </div>

                <!-- About Section Content-->
                <!--
                <div class="row">
                    <div class="col-lg-4 ml-auto"><p class="lead">About the site</p></div>
                    <div class="col-lg-4 mr-auto"><p class="lead">About me</p></div>
                </div>
                -->
                <!-- About Section Button-->
                <div class="text-left mt-4">
                    <div id="story1" class="row justify-content-left">
                        <div class="col-lg-7">
                            <h2>Manage your Account</h2>
                            <% if(!user.emailValidated){ %>
                                <div class="alert-message alert-message-warning" role="alert">
                                    <h3 >Email not verified!</h3>
                                    <p>Please check your email for a verifacation link and click on it to finish the verification process.  <strong>Be sure to check your spam folder</strong> if you do not see it in your inbox. If it has not arrived after a few minutes <a href='/api/user/revalidate/<%- user.email %>'>Re-send verification email</a></p>
                                </div>
                            <% } %>
                            <section>
                                <form action="/api/user" method="POST">
                                    <div class="form-group">
                                        <input type="hidden" name="_method" value="PATCH" />
                                        Email: <strong><%- user.email %></strong> 
                                        <% if(user.emailValidated){ %>
                                            <span class="alert-success">[ Verified ]</span>
                                        <% } %>
                                        <br />

                                        <input type="hidden" value="<%- user.email %>" class="form-control form-control-lg" name="manageEmail" id="manageEmail" required>
                                        Username: <strong><%- user.username %></strong>
                                        <br />
                                        First Name: <input type="input" class="form-control form-control-lg" name="firstName" value="<%- user.firstName %>" id="firstName" placeholder="First Name" required>
                                        Last Name: <input type="input" class="form-control form-control-lg" name="lastName" value="<%- user.lastName %>" id="lastName" placeholder="Last Name" required>
                                        <br />  

                                        <div class="custom-control custom-checkbox">
                                            <% if(user.subscriptionActive) { %>
                                                <input type="checkbox" class="custom-control-input" id="subscriptionActive" name="subscriptionActive" checked />
                                            <% } else { %>
                                                <input type="checkbox" class="custom-control-input" id="subscriptionActive" name="subscriptionActive" />
                                            <% } %>
                                            <label class="custom-control-label" for="subscriptionActive">Subcription Active <- Turn on or off emails from us</label>
                                        </div>
                                        <br />
                                        <h5>Your Interests (Helps us find the best courses and collaborators for you!)</h5>
                                        <div class="custom-control custom-checkbox">
                                            <% if(user.beginningProgramming) { %>
                                                <input type="checkbox" class="custom-control-input" id="beginningProgramming" name="beginningProgramming" checked>
                                            <% } else { %>
                                                <input type="checkbox" class="custom-control-input" id="beginningProgramming" name="beginningProgramming">
                                            <% } %>

                                            <label class="custom-control-label" for="beginningProgramming">Beginning Programming</label>
                                        </div>
                                        <div class="custom-control custom-checkbox">
                                            <% if(user.intermediateProgramming) { %>
                                                <input type="checkbox" class="custom-control-input" id="intermediateProgramming" name="intermediateProgramming" checked>
                                            <% } else { %>
                                                <input type="checkbox" class="custom-control-input" id="intermediateProgramming" name="intermediateProgramming">
                                            <% } %>
                                            
                                            <label class="custom-control-label" for="intermediateProgramming">Intermediate Programming</label>
                                        </div>
                                        <div class="custom-control custom-checkbox">
                                            <% if(user.advancedProgramming) { %>
                                                <input type="checkbox" class="custom-control-input" id="advancedProgramming" name="advancedProgramming" checked>
                                            <% } else { %>
                                                <input type="checkbox" class="custom-control-input" id="advancedProgramming" name="advancedProgramming">
                                            <% } %>
                                            
                                            <label class="custom-control-label" for="advancedProgramming">Advanced Programming</label>
                                        </div>
                                        <div class="custom-control custom-checkbox">
                                            <% if(user.mobileDevelopment) { %>
                                                <input type="checkbox" class="custom-control-input" id="mobileDevelopment" name="mobileDevelopment" checked>
                                            <% } else { %>
                                                <input type="checkbox" class="custom-control-input" id="mobileDevelopment" name="mobileDevelopment">
                                            <% } %>
                                            
                                            <label class="custom-control-label" for="mobileDevelopment">Mobile Development</label>
                                        </div>
                                        <div class="custom-control custom-checkbox">
                                            <% if(user.roboticsProgramming) { %>
                                                <input type="checkbox" class="custom-control-input" id="roboticsProgramming" name="roboticsProgramming" checked>
                                            <% } else { %>
                                                <input type="checkbox" class="custom-control-input" id="roboticsProgramming" name="roboticsProgramming">
                                            <% } %>
                                            
                                            <label class="custom-control-label" for="roboticsProgramming">Robotics Programming</label>
                                        </div>
                                        <div class="custom-control custom-checkbox">
                                            <% if(user.webApplications) { %>
                                                <input type="checkbox" class="custom-control-input" id="webApplications" name="webApplications" checked>
                                            <% } else { %>
                                                <input type="checkbox" class="custom-control-input" id="webApplications" name="webApplications">
                                            <% } %>
                                            
                                            <label class="custom-control-label" for="webApplications">Web Applications</label>
                                        </div>
                                        <div class="custom-control custom-checkbox">
                                            <% if(user.web3) { %>
                                                <input type="checkbox" class="custom-control-input" id="web3" name="web3" checked>
                                            <% } else { %>
                                                <input type="checkbox" class="custom-control-input" id="web3" name="web3">
                                            <% } %>
                                            
                                            <label class="custom-control-label" for="web3">Web 3 / Blockchain</label>
                                        </div>
                                        <div class="custom-control custom-checkbox">
                                            <% if(user.iotProgramming) { %>
                                                <input type="checkbox" class="custom-control-input" id="iotProgramming" name="iotProgramming" checked>
                                            <% } else { %>
                                                <input type="checkbox" class="custom-control-input" id="iotProgramming" name="iotProgramming">
                                            <% } %>

                                            <label class="custom-control-label" for="iotProgramming">Internet of Things (IoT) Programming</label>
                                        </div>
                                        <div class="custom-control custom-checkbox">
                                            <% if(user.databaseDesign) { %>
                                                <input type="checkbox" class="custom-control-input" id="databaseDesign" name="databaseDesign" checked>
                                            <% } else { %>
                                                <input type="checkbox" class="custom-control-input" id="databaseDesign" name="databaseDesign">
                                            <% } %>
                                            
                                            <label class="custom-control-label" for="databaseDesign">Database Design</label>
                                        </div>
                                        <div class="custom-control custom-checkbox">
                                            <% if(user.relationalDatabase) { %>
                                                <input type="checkbox" class="custom-control-input" id="relationalDatabase" name="relationalDatabase" checked>
                                            <% } else { %>
                                                <input type="checkbox" class="custom-control-input" id="relationalDatabase" name="relationalDatabase">
                                            <% } %>

                                            <label class="custom-control-label" for="relationalDatabase">Relational Databases</label>
                                        </div>
                                        <div class="custom-control custom-checkbox">
                                            <% if(user.noSqlDatabase) { %>
                                                <input type="checkbox" class="custom-control-input" id="noSqlDatabase" name="noSqlDatabase" checked>
                                            <% } else { %>
                                                <input type="checkbox" class="custom-control-input" id="noSqlDatabase" name="noSqlDatabase">
                                            <% } %>
                                            
                                            <label class="custom-control-label" for="noSqlDatabase">NoSQL Databases</label>
                                        </div>
                                        <div class="custom-control custom-checkbox">
                                            <% if(user.objectRelationalMapping) { %>
                                                <input type="checkbox" class="custom-control-input" id="objectRelationalMapping" name="objectRelationalMapping" checked>
                                            <% } else { %>
                                                <input type="checkbox" class="custom-control-input" id="objectRelationalMapping" name="objectRelationalMapping">
                                            <% } %>
                                            
                                            <label class="custom-control-label" for="objectRelationalMapping">Object Relational Mapping</label>
                                        </div>
                                      
                                    </div>
                                    <button type="submit" id="userManageButton" class="btn btn-primary btn-lg btn-block">Update Information</button>
                                </form>
                                <br />
                            </section>

                        </div>
                        <div class="col-lg-5">
                            
                            <img src="<%- locals.user.profileFilename %>" alt="Profile Picture" title="Profile Picture" class="profile-large-image" /></a>
                            <% if(!!locals.uploadMessage){ %>
                                <div class="alert-message alert-message-warning" role="alert">
                                    <h3 >Error Uploading File</h3>
                                    <p><%= uploadMessage %></p>
                                </div>
                            <% } %>
                            <form action="/api/user/uploadProfilePicture" method="POST" enctype="multipart/form-data" style="width: 100%;">
                                <div class="mb-2">
                                    <label for="formFile" class="form-label">Upload a profile picture (1MB Max size)</label>
                                    <input class="form-control btn-secondary" accept="image/jpeg,image/jpg,image/png" type="file" id="formFile" name="profileImage">
                                </div>
                                <button type="submit" class="btn btn-primary">Upload</button>
                            </form>
                            

                            <%
                            console.log(JSON.stringify(user.roles));
                            if(user.roles.filter(role => role.roleName === "Creator").length > 0) {
                                %>
                                <hr />
                                <h2>Create Content</h2>

                                <a class="card" style="width: 100%;" href="/a">
                                    <img class="product-img-overlay" src="<%- locals.user.profileFilename %>" alt="Card image cap">
                                    <div class="card-body product-card-text-raised">
                                        <h5 class="card-title">Creator Panel</h5>
                                        <p class="card-text">Manage, edit and create new goals, topics and resources</p>
                                    </div>
                                </a> 
                                <%
                            }
                            %>

                            <div class="divider-custom">
                                <div class="divider-custom-line cherry-red-bg-color"></div>
                                <div class="divider-custom-icon"><i class="fas fa-chalkboard-teacher cherry-red-color"></i></div>
                                <div class="divider-custom-line cherry-red-bg-color"></div>
                            </div>

                            <h2>Membership</h2>

                            <% 
                            if(products && products.length > 0) {
                                let memberships = products.filter(product => product.productType === 'membership');
                                memberships.forEach(membership => {
                                    
                                    let tempStatus = membership.status;
                                    if(membership.status === 'complete') {
                                        tempStatus = 'Valid'
                                    }
                                
                                    %>
                                    <div class="card" style="width: 100%;">
                                        <img class="product-img-overlay" src="<%- membership.productStaticImage %>" alt="Card image cap">
                                        <div class="card-body product-card-text-raised">
                                            <h5 class="card-title"><%- membership.productName %></h5>
                                            <p class="card-text"><%- membership.productDescription1 %></p>
                                            <p class="card-text">Status: <%- tempStatus %></p>
                                        </div>
                                    </div> 
                                    <%
                                })
                            }
                            else {
                                %> 
                                <div class="card" style="width: 100%;">
                                    
                                    <div class="card-body product-card-text-raised">
                                        <h5 class="card-title">No Membership currently</h5>
                                        <p><a href="/community/purchase">Learn more about membership</a></p>
                                    </div>
                                </div> 
                                <%
                            }
                            %>
                            
                            <div class="divider-custom">
                                <div class="divider-custom-line cherry-red-bg-color"></div>
                                <div class="divider-custom-icon"><i class="fas fa-laptop-code cherry-red-color"></i></div>
                                <div class="divider-custom-line cherry-red-bg-color"></div>
                            </div>
                            <h2>Products</h2>
                            
                            
                            <% 

                            if(products && products.length > 0) {
                                let nonMemberships = products.filter(product => product.productType === 'product');
                                nonMemberships.forEach(product => {
                                    
                                    let tempStatus = product.status;
                                    if(product.status === 'complete') {
                                        tempStatus = 'Paid - Awaiting Shipping'
                                    }
                                    
                                    %>
                                    <div class="card" style="width: 100%;">
                                        <img class="product-img-overlay" src="<%- product.productStaticImage %>" alt="Card image cap">
                                        <div class="card-body product-card-text-raised">
                                            <h5 class="card-title"><%- product.productName %></h5>
                                            <p class="card-text"><%- product.productDescription1 %></p>
                                            <p class="card-text">Status: <%- tempStatus %></p>
                                        </div>
                                    </div> 
                                    <%
                                })
                            }
                            else {
                                %> 
                                <div class="card" style="width: 100%;">
                                    
                                    <div class="card-body product-card-text-raised">
                                        <h5 class="card-title">You have no purchases so far,</h5>
                                        <p>Check out the <a href="/codebot">Code Bot 3π+</a></p>
                                    </div>
                                </div> 
                                <%
                            }
                            %>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer-->
        <footer class="footer text-center">
            <%- include('../partials/footer'); %>
        </footer>
        <!-- Copyright Section-->
        <div class="copyright py-4 text-center text-white">
            <%- include('../partials/copyright'); %>
        </div>
        <!-- Scroll to Top Button (Only visible on small and extra-small screen sizes)-->
        <div class="scroll-to-top d-lg-none position-fixed">
            <a class="js-scroll-trigger d-block text-center text-white rounded" href="#page-top"><i class="fa fa-chevron-up"></i></a>
        </div>
        <%- include('../partials/jsincludes'); %>
    </body>
</html>